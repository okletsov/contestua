{
  "gitSyncId": "661eca10b7e3352fe43e8a8c_a01f0eab-c697-498d-8718-86eb8a5454b4",
  "id": "Победитель года_cr_annual_live",
  "pluginId": "mysql-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "select\n    row_number() over (\norder by\n    `t2`.`total_points` desc) AS `place`,\n    `t2`.`nickname` AS `nickname`,\n    `t2`.`units` AS `units`,\n    `t2`.`roi` AS `roi`,\n    `t2`.`current_contest_place` AS `current_contest_place`,\n    `t2`.`current_contest_points` AS `current_contest_points`,\n    `t2`.`prior_contests_points` AS `prior_contests_points`,\n    `t2`.`total_points` AS `total_points`\nfrom\n    (\n\tselect\n\t        `t1`.`nickname` AS `nickname`,\n\t        sum(`t1`.`units`) AS `units`,\n\t        sum(`t1`.`roi`) AS `roi`,\n\t        sum(`t1`.`place`) AS `current_contest_place`,\n\t        sum(`t1`.`current_contest_points`) AS `current_contest_points`,\n\t        sum(`t1`.`new_points`) AS `prior_contests_points`,\n\t        sum(case when `t1`.`current_contest_points` is null then 0 else `t1`.`current_contest_points` end) + sum(case when `t1`.`new_points` is null then 0 else `t1`.`new_points` end) AS `total_points`\n\t    from\n\t        (\n\t\tselect\n\t\t    `uscp`.`user_id` AS `user_id`,\n\t\t    `un`.`nickname` AS `nickname`,\n\t\t    case\n\t\t        when `cg`.`place` > 2 then `ppc`.`participants` - `cg`.`place` + 1\n\t\t        when `cg`.`place` = 2 then `ppc`.`participants` - `cg`.`place` + 2\n\t\t        when `cg`.`place` = 1 then `ppc`.`participants` - `cg`.`place` + 3\n\t\t        when `cg`.`place` = 0 then 1\n\t\t    end AS `new_points`,\n\t\t    case\n\t\t        when `cro`.`place` > 2 then `ppc`.`participants` - `cro`.`place` + 1\n\t\t        when `cro`.`place` = 2 then `ppc`.`participants` - `cro`.`place` + 2\n\t\t        when `cro`.`place` = 1 then `ppc`.`participants` - `cro`.`place` + 3\n\t\t        when `cro`.`place` = 0 then 1\n\t\t    end AS `current_contest_points`,\n\t\t    `cro`.`place` AS `place`,\n\t\t    `cro`.`units` AS `units`,\n\t\t    `cro`.`roi` AS `roi`,\n\t\t    `ppc`.`participants` AS `participants`\n\t\tfrom\n\t\t    ((((`user_seasonal_contest_participation` `uscp`)\n\t\tjoin `user_nickname` `un` on\n\t\t    (`un`.`user_id` = `uscp`.`user_id`))\n\t\tjoin `participants_per_contest` `ppc` on\n\t\t    (`ppc`.`id` = `uscp`.`contest_id`))\n\t\tleft join `cr_general` `cg` on\n\t\t    (`cg`.`user_id` = `uscp`.`user_id`\n\t\t        and `cg`.`contest_id` = `uscp`.`contest_id`\n\t\t        )\n\t\tleft join `cr_raw_ongoing` `cro` on\n\t\t    (`cro`.`user_id` = `uscp`.`user_id`\n\t\t        and `cro`.`seasonal_contest_id` = `uscp`.`contest_id`\n\t\t        ))\n\t\twhere\n\t\t     `un`.`is_active` = 1\n\t\t     and uscp.contest_id in (\n\t\t     \tSELECT \n\t\t     \t\taxsc.seasonal_contest_id\n\t\t     \tfrom annual_x_seasonal_contest axsc\n\t\t     \t\tjoin contest c on c.id = axsc.seasonal_contest_id\n\t\t     \twhere c.`year` = {{Select_contest.selectedOptionValue}}\n\t\t     )\n\t\torder by\n\t\t    `un`.`nickname`\n\t\t) t1\n\tgroup by t1.user_id\n) t2",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "contest",
      "isAutoGenerated": false,
      "name": "contest",
      "pluginId": "mysql-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "executeOnLoad": true,
    "name": "cr_annual_live",
    "pageId": "Победитель года",
    "userSetOnLoad": false
  }
}